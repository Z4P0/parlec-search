/*!
 * monte v0.0.7 (http://www.luisrosar.io/lab/monte)
 * Copyright 2014-2015 luis rosario {zapo}
 * Licensed under MIT (https://github.com/aztec8/monte/blob/master/LICENSE)
 */

!function(a,b,c){"use strict";a.parlec={tag:"P A R L E C",DATA:{},modules:{},init:function(){console.log(this.tag);for(var a in this.modules)this.modules[a].init()},utils:{render_template:function(a){if(!a.template||""===a.template)return void $(a.target).html("");var b=Handlebars.compile($(a.template).html()),c=b(a.context?a.context:{});a.append?$(a.target).append(c):a.prepend?$(a.target).prepend(c):$(a.target).html(c)}}},$(b).ready(function(){$(b).foundation(),parlec.init()})}(window,window.document),function(a,b,c){"use strict";parlec.modules["parts-search"]={name:"parts-search",tag:"P A R L E C   P A R T S   S E A R C H",settings:{product_families:{Toolholding:{json_url:"/data/parlec-toolholding.json"}}},config:{},data:{},results:{},setup_incomplete:!0,get_json_data:function(a,b){var c=this;$.getJSON(c.settings.product_families[a].json_url,function(d){for(var e,f=!1,g=parlec.DATA[c.name].products,h=0;h<g.length;h++)g[h].name===a&&(f=!0,e=g[h]);f?e.products=d:g.push({name:a,products:d}),c.data=parlec.DATA[c.name],c.setup_incomplete&&c.complete_initial_setup(),b&&b()})},remove_disabled_attribute_from:function(a){$.each(a,function(a,b){$(b).attr("disabled",!1)})},render_next_options:function(a){var b=this.data.products[this.config.product_solution.index].products,d=[];if(this.config.system!==c||this.config.taper_type!==c||this.config.part_number!==c)for(var e=0;e<b.length;e++){var f=b[e],g=!0,h=!0,i=!0;this.config.system!==c&&f.SYSTEM!==this.config.system.name&&(g=!1),this.config.taper_type!==c&&f["TAPER TYPE"]!==this.config.taper_type.name&&(h=!1),this.config.part_number!==c&&f["PART NUMBER"]!==this.config.part_number.name&&(i=!1),g&&h&&i&&d.push(f)}else d=b;for(var j=[],k=0;k<d.length;k++)if(j.length){for(var l=!1,m=0;m<j.length;m++)j[m].name===d[k][a.field]&&(l=!0);l||j.push({name:d[k][a.field],product:d[k]})}else j.push({name:d[k][a.field],product:d[k]});var n=$(a.target);j.length?(parlec.utils.render_template({target:a.target,template:"#option-tpl",context:{options:j}}),this.results=j,n.attr("disabled")&&n.attr("disabled",!1)):(alert("Sorry! No results found. Try modifying your search."),n.attr("disabled",!0))},add_event_listeners:function(){var a=this;$("#product-solution").on("change",function(b){var c=$(b.target).find("option:selected");a.config.product_solution={name:c.val(),index:c.data("index")},a.render_next_options({target:"#system",field:"SYSTEM"})}),$("#system").on("change",function(b){var c=$(b.target).find("option:selected");a.config.system={name:c.val(),index:c.data("index")},a.render_next_options({target:"#taper-type",field:"TAPER TYPE"})}),$("#taper-type").on("change",function(b){var c=$(b.target).find("option:selected");a.config.taper_type={name:c.val(),index:c.data("index")},a.render_next_options({target:"#part-number-select",field:"PART NUMBER"})}),$("#part-number-select").on("change",function(b){var c=$(b.target).find("option:selected").data("index");a.render_product(a.results[c].product)});var b=$("#part-number");b.on("keyup",function(c){var d=b.val().trim();""!==d&&a.search_for_part_number(d)})},render_product:function(a){a.image===c&&(a.image="/images/product-image-1.jpg");var d={};for(var e in a)d[s.underscored(e)]=a[e];parlec.utils.render_template({target:"#results",template:"#results-tpl",context:{data:d}}),$(b).foundation("tab","reflow")},init:function(){function a(){parlec.utils.render_template({target:"#product-solution",template:"#option-tpl",context:{options:parlec.DATA[c.name].products}})}if($("#parts-search").length){parlec.DATA[this.name]={name:this.tag,products:[]};for(var b in this.settings.product_families){var c=this;this.get_json_data(b,a)}this.add_event_listeners(),parlec.DATA[this.name].products.length&&this.complete_initial_setup()}},complete_initial_setup:function(){this.remove_disabled_attribute_from([$("#product-solution"),$("#part-number")]),$("#product-solution").attr("data-root",!0),this.setup_incomplete=!1},search_for_part_number:function(a){console.log(a);for(var b=0;b<parlec.DATA[this.name].products.length;b++)for(var c=parlec.DATA[this.name].products[b].products,d=0;d<c.length;d++)c[d]["PART NUMBER"]==a&&(console.log("match"),console.log(c[d]))},update_1:function(a){a.target.getAttribute("data-root")&&this.reset_search();var b=parseInt(a.target.getAttribute("data-select-index"),10),c=parseInt(a.target.selectedOptions[0].getAttribute("data-index"),10);if(b===this.current.select_box_index)this.current.data_point=this.current.data_point.products[c],this.current.select_box_index++,this.current.history.push(c);else if(b<this.current.select_box_index){for(var d=this.current.select_box_index-b,e=this.data,f=[],g=0;g<this.current.history.length-d;g++)e=e.products[this.current.history[g]],f.push(this.current.history[g]);f.push(c),this.current.data_point=e.products[c],this.current.history=f,this.current.select_box_index=b+1}console.log(this.current.data_point,this.current.select_box_index),this.render()}}}(window,window.document);